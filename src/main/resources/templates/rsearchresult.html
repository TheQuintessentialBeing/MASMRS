<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:width="http://www.w3.org/1999/xhtml">
<head th:replace="base :: baseheader">
    <title>Product List</title>
</head>
    <style>
        @media print {
          body {
            margin: 0;
            padding: 0;
          }

          .printable-page {
            width: 8.27in; /* A4 width */
            height: 11.69in; /* A4 height */
            padding: 1in;
            border: 2px solid black;
            box-sizing: border-box;
            page-break-after: always;
          }
        }
        .printable-page {
          margin: 20px auto;
          background: white;
        }
    </style>
<body>
<div th:replace="base :: navlinks"></div>
<!--<div class="container" class="printable-page">-->
    <div class="printable-page">
    <div th:if="${errorMessage !=null }">
        <p th:text="${errorMessage}" style="color:red;"></p>
    </div>
    <div th:if="${errorMessage == null }">
        <p style="
           text-align: center;
           font-weight: 800;
           font-size: 32px;
           margin-bottom: 20px;
           border-bottom: 2px solid #ccc; /* adds subtle underline */
           padding-bottom: 10px;"
        > School of Mieraf Academy Student's Report</p>
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px;">
            <!-- Left side: Student name -->
            <div style="">
                <span> [[${header.lastName}]] , [[${header.firstName}]] [[${header.middleName}]]</span>
                <span th:text="${printingDate}"></span>
                <p><span> Dob: [[${header.dateOfBirth}]] Gender: [[${header.gender}]]</span>
                    <span> A/Y: [[${header.academicYear}]] Grade: [[${header.grade}]]- [[${header.section}]] </span>
                </p>
            </div>
            <!-- Right side: Buttons -->
            <div style="padding:20px; color:black;">
                <button th:disabled id="printbtn" onclick="printPDF()" type="button"
                        class="btn btn-light cs-action-button">
                   Print/Download
                </button>
                <a href="/records/report/download" target="_blank">
                <button  type="button" class="btn btn-light cs-action-button">
                 Email (pdf)
                </button></a>
                <button onclick="emailInvoice()">Email Me the Invoice</button>



            </div>
        </div>
        <table class="table .table-bordered">
            <tr>
                <th>Subject(s)</th>
                <th>Quarter I</th>
                <th>Quarter II</th>
                <th>Quarter III</th>
                <th>Quarter IV</th>
            </tr>
            <tr th:each="c: ${detail}">
                <td>[[${c.subject}]]</td>
                <td>[[${c.q1}]]</td>
                <td>[[${c.q2}]]</td>
                <td>[[${c.q3}]]</td>
                <td>[[${c.q4}]]</td>
            </tr>
            <tr>
                <td>Sum</td>
                <td> [[${header.quarterOneSum}]]</td>
                <td> [[${header.quarterTwoSum}]]</td>
                <td> [[${header.quarterThreeSum}]]</td>
                <td> [[${header.quarterFourSum}]]</td>
            </tr>
            <tr>
                <td>Rank</td>
                <td> [[${header.quarterOneRank}]] / [[${header.numberOfSubjects}]]</td>
                <td> [[${header.quarterTwoRank}]] / [[${header.numberOfSubjects}]]</td>
                <td> [[${header.quarterThreeRank}]] / [[${header.numberOfSubjects}]]</td>
                <td> [[${header.quarterFourRank}]] / [[${header.numberOfSubjects}]]</td>
            </tr>
        </table>
        <p><b> Ranks </b> Semester I : [[${header.semesterOneRank}]] Semester II: [[${header.semesterTwoRank}]] All
            Section : [[${header.allSectionRank}]] </p>
        <p>Disclaimer : Printing this report or viewing it without the proper access, is violation of privacy. </p>
    </div>
    <script>
             function printPDF() {
                const pdfWindow = window.open("/records/report/download", "_blank");
                pdfWindow.focus();

                // Wait for the PDF to load before printing
                pdfWindow.onload = () => {
                    pdfWindow.print();
                };
            }

             function emailInvoice() {
                        fetch('/records/email-invoice', {
                            method: 'POST'
                        })
                        .then(response => response.text())
                        .then(data => alert(data))
                        .catch(err => alert('Error: ' + err));
                    }

    </script>
    <script type="text/javascript" th:src="@{/webjars/jquery/3.2.1/jquery.min.js/}"></script>
    <script type="text/javascript" th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}"></script>
</div>
<p>Copyright @2025 Report generated by School of Mieraf Academy Student Records & Management Systems. </p>
</body>
</html>